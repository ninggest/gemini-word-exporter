# Gemini Word Exporter - 开发规范与功能要求

## 1. 核心功能要求
- **格式一致性**：导出文档必须维持 Route A 风格，即单倍行距、首行缩进、两端对齐、使用“仿宋”字体。
- **页眉标准**：页眉应包含律所 Logo (左侧) 和格言 (右侧)，中间由制表位分隔，底部带有一条细横线。
- **页脚标准**：页脚应包含地址、电话及页码（居右）。
- **内容清洗**：必须过滤掉 Gemini 生成内容中常见的无关空行，尤其是单行回车，以保证排版紧凑。
- **表格支持**：必须正确渲染 Markdown 表格，使用 docx.js 的 Table/TableRow/TableCell 类，并支持自定义表格字号（默认 12pt）。
- **标题加粗**：自动识别 Markdown 标题并加粗（不限制标题长度），确保长标题也能正确格式化。

## 2. 技术规格
- **Logo 加载策略**：
  - 优先使用用户上传并存储在 `chrome.storage` 中的 Base64 格式 Logo。
  - 如无自定义 Logo，则降级使用插件自带的 `assets/logo.png`。
- **缩进单位**：首行缩进固定为 2 字符（2ch）。在 docx.js 中需转换为 twips 计算（2 * font-size * 20）。
- **渲染环境**：所有的 Word 生成逻辑都在 `offscreen.html` 环境中运行，通过 `offscreen.js` 驱动 `DocxGenerator` 类。
- **库依赖**：项目依赖 `docx.js` (版本 v4.0+)。

## 3. 默认值配置
- **Logo**：默认为广西万益律师事务所 Logo。
- **页眉右侧（格言）**：“全国优秀律师事务所 全国文明单位”
- **页脚左侧（地址）**：“地址：南宁市青秀区中心路 9 号九洲国际 27 层”
- **页脚右侧（电话）**：“电话：0771-2854881”

## 4. 开发流程
- **修改生成逻辑**：主要修改 `background/docx-generator.js`。
- **修改数据流**：主要修改 `background/offscreen.js` 或 `background/service-worker.js`。
- **权限与隐私**：
  - 插件仅在本地处理数据，不收集任何用户信息。
  - 发布时需在 Privacy Policy 中声明 activeTab, scripting, storage, downloads, offscreen 等权限的必要性。
- **代码提交**：保持原子性提交，确保 README、manifest.json 版本号同步更新。
